(function(){var A=false,F=this,D=(function(){var K=["log","error","info","warn","time","timeEnd","dir"];if(typeof F.console==="undefined"){var M={};for(var L=0;L<K.length;L++){M[K[L]]=function(){};}return M;}return F.console;})(),H=function(){return parseInt((new Date().valueOf()+Math.floor(Math.random()*new Date().valueOf()))/(Math.floor(Math.random()*9)+1),10);},C=function(){A&&D.log(Array.prototype.slice.apply(arguments,[0]));},B=function(M,L){if(!A){return ;}var K=B;K.timers=K.timers||{};K.timers[M]={time:new Date().valueOf(),args:L};},I=function(N,M){if(!A){return ;}var L=B;L.timers=L.timers||{};M=(M)?" ("+M+")":"";var O=(L.timers[N].args)?": "+L.timers[N].args:"",K=N+O+"\n\t"+(new Date().valueOf()-L.timers[N].time)/1000;D.log(K+M);L.timers[N]={};};var G=F.meelo=F.meelo||{};var E=F.meelo.Store=function(M,L,K){return new E.item.__init__(M,L,K);};E.item={__init__:function(M,L){var K=this;M=M||[];this.__id__=H();this.data={items:[]};this.url=null;this.__initialised__=false;this.__ready__=false;this.__loaded__=false;this.prevObj=L&&L.store?L:M&&M.__store__?M.__store__:null;this.store=true;this.selector=null;this.properties={callbacks:{init:[],update:[],ready:[]},instance_callbacks:{init:[],update:[],ready:[]},callback_queue:{}};if(this.prevObj){J.extend(this.properties,this.prevObj.properties);}else{if(L&&L.constructor===Object){J.extend(this.properties,L);}else{if(L){C("Invalid: Second argument must be an object with options");}}}this.items=function(){return this.data.items;};this.length=function(){return this.data.items.length;};if(typeof M==="string"){this.url=M;}else{this.push(M,Boolean(this.prevObj));}return this;},__load__:function(M){if(!this.url&&!M){return this;}var L=this,K=function(O,N){var P=Array.prototype.slice.apply(arguments);L.__dispatch__("callbacks","load",P);};this.url=M||this.url;this.__xhr__&&this.__xhr__.abort();this.__xhr__=jQuery.ajax({url:this.url,type:"get",dataType:"json",success:function(O,N){K.apply(this,Array.prototype.slice.apply(arguments));},error:function(O,N){K.apply(this,Array.prototype.slice.apply(arguments));}});return this;},__ready__:function(L,K){var M=[L,K];this.publish("ready",M);return this;},reload:function(K){this.data={};return this.load((K||this.url));},end:function(){return this.prevObj||E([]);},root:function(){var K=this;do{K=K.end();}while(K.end().length());return K;},__attach__:function(O,M,R){var L=this,P=this.properties[O]=this.properties[O]||{},Q=this.__initialised__,K=this.properties.callback_queue[O+":"+M];P[M]=P[M]||[];C("attach",O,M);typeof R=="function"?P[M].push(R):C("Error","Second parameter must be a function");if(O=="callbacks"&&M=="init"){R.apply(L);}else{if(K&&K.length){for(var N=0;N<K.length;N++){L.__dispatch__(O,M,K[N]);}delete this.properties.callback_queue[O+":"+M];}else{this.length()&&M=="ready"&&((this.url&&this.__loaded__)||!this.url)&&L.__dispatch__(O,M);M=="load"&&!this.__xhr__&&this.__load__();}}return this;},__dispatch__:function(R,L,P){var S=this,O=this.properties[R]||{},N=O[L]||[],K,Q;if(P&&P.constructor!==Array){P=[P];}C("dispatch",R,L,P,N.length);if(!N.length&&!(R=="callbacks"&&(L=="init"||L=="ready"))){this.properties.callback_queue[R+":"+L]=this.properties.callback_queue[R+":"+L]||[];this.properties.callback_queue[R+":"+L].push(P||[]);return this;}if(R=="instance_callbacks"){if((L==="init"||L=="update")&&P&&P.length>=1){J.each(P[0],function(T){M(T,P.slice(1));});}else{this.each(function(U,T){M(U);});}}else{if(L=="init"){this.__initialised__=true;}else{if(L==="ready"){this.__ready__=true;}}M(this);}return this;function M(V,T){var W;T=T||P;for(var U=0;U<N.length;U++){W=N[U].apply(V,T);if(W&&L==="load"){this.__loaded__=true;S.push(W);}if(W===false){break;}}}},init:function(K){K?this.__attach__("callbacks","init",K):this.__dispatch__("callbacks","init");return this;},ready:function(K){K?this.__attach__("callbacks","ready",K):this.__dispatch__("callbacks","ready");return this;},load:function(K){K?this.__attach__("callbacks","load",K):this.__dispatch__("callbacks","load");return this;},listen:function(K,L){return this.__attach__("callbacks",K,L);},publish:function(L,K){return this.__dispatch__("callbacks",L,K);},bind:function(K,L){return this.__attach__("instance_callbacks",K,L);},trigger:function(L,K){return this.__dispatch__("instance_callbacks",L,K);},eq:function(K){var L=this.data.items[(K||0)]||{};return E([L],this);},get:function(L){var K=this.filter.apply(this,Array.prototype.slice.apply(arguments,[0]));return K.length()?K.items()[0]:null;},slice:function(M,K){var L=this.items();return E(Array.prototype.slice.apply(L,arguments),this);},filter:function(){var T=this,O,K=Array.prototype.slice.apply(arguments),Q=T.data.items,R=J,L=R.filter.helpers,M=(function(){var V=[];for(var U in L){V.push(U);}return V;})();if(K.length==2&&typeof K[0]==="string"&&typeof K[1]!=="undefined"){var N=K[0],S=K[1];K={};K[N]=S;K=[K];}B("FIND");(function P(V){var U=[];R.each(V,function(a,X){if(typeof X==="string"){var Z,Y=new RegExp("__("+M.join("|")+")$"),W=X.replace(Y,""),b=X.match(Y);if(b){b=b[1];Z=L[b];V[W]=Z(a);delete V[X];}}if(typeof a==="object"){P(a);}U.push(a);});return U;})(K);C("Filter:",K);O=R.map(K,function(U){return J.filter(U,Q)||[];});I("FIND",O.length+" items, incl. duplicates");O=E(O,this);O.selector=K;return O;},push:function(O,L){var K=this,M,N=this.data.items=this.data.items||[];if(O.constructor==Array&&O.length){M=O;}else{if(O.constructor==Object&&O.store&&O.data.items){M=O.data.items;}else{if(O.constructor==Object){M=[O];}else{return this;}}}!L&&this.trigger("init",[M]);if(M){!L&&this.publish("beforeChange",["push",M]);this.data.items=N.concat(M);!L&&this.publish("change",["push",M]);}M&&!L&&!this.__ready__&&this.publish("ready",[M]);return this;},insert:function(K){return this.push(K);},update:function(R){if(!this.length()){return this;}var M=this,Q,N=Array.prototype.slice.apply(arguments);if(N.length==2&&typeof N[0]=="string"&&typeof N[1]!=="undefined"&&J.filter(N[1].constructor,[String,Number,RegExp])){var L=N[0],K=N[1];R={};R[L]=K;}var P=0;this.publish("beforeChange",["update",this.items()]);B("Update");var O=[];this.each(function(V,T){var Y={},S;for(var U in R){if(V[U]===R[U]){continue;}var X=V[U],W=R[U];S=true;P++;W=(W.constructor===Function)?W(X):(W.constructor===RegExp&&X.constructor===String)?X.match(W):W;V[U]=W;Y[U]={from:X||"none",to:W};O.push(V);}S&&M.trigger("update",[[V],Y]);});I("Update",this.length()+" record(s), "+P+" attribute(s)");this.publish("change",["update",O]);return this;},remove:function(){this.publish("beforeChange",["remove",K]);B("Remove");var L=this,M=this.end(),K=this.items();this.each(function(O,N){O.__delete__=true;});while(M&&M.length()){M.each(function(O,N){if(O.__delete__){this.data.items.splice(N,1);E(O).trigger("delete",[[O]]);}});M=M.end();}I("Remove");this.publish("change",["remove",K]);this.data.items=[];return this;},merge:function(N,K){D.time("Merge");var L=(typeof K==="string")?Array.prototype.slice.apply(arguments,[1]):null,M=this.items();N=(N&&N.store)?N.items():N;K=(typeof K=="function")?K:function(Q,P){for(var O in Q){if((L&&L.indexOf(O)===-1)||!Q.hasOwnProperty(O)){continue;}if(Q[O]!==P[O]){return null;}}return true;};this.length()&&this.each(function(P){for(var O=N.length-1;O>=0;O--){var R=N[O],Q=K(P,R);if(Q){N.splice(O,1);}}});this.push(N);D.timeEnd("Merge");return this;},print:function(K,L){K=K||this.keys();var M;if(K.constructor===String||K.constructor===Array){K=(K.constructor===Array)?K:[K];L=L||(function(){return J.map(K,function(O,N){return"$"+(N+1);},function(N){return N.reverse().join(", ");});})();this.each(function(Q,N){var P=L;for(var O=K.length-1;O>=0;O--){P=P.replace(new RegExp("\\$"+(O+1),"g"),Q[K[O]]||"");}return P.replace(/\$0/g,N+1);},function(N){M=N.reverse();});}return M;},each:function(L,K){L=(typeof L=="function")?L:false;if(!L||!this.data.items){return this;}return J.each.apply(this,[this.data.items,L,K]);},map:function(L,K){L=(typeof L=="function")?L:false;if(!L||!this.data.items){return this;}return J.map.apply(this,[this.data.items,L,K]);}};E.item.__init__.prototype=E.item;var J=E.utils={regexp:{escape:function(K){K=K||"";return K.toString().replace(/([.*+?^${}()|[\]\/\\])/g,"\\$1");}},filter:function(Q,N){var R=[];var P=function(U,W){var Y=U.length,Z=W.length,V=null,T=O;if(Y!==Z||Y===0||Z===0){return null;}for(var X=Y-1;X>=0;X--){if(!U.hasOwnProperty(X)||!W.hasOwnProperty(X)){continue;}if(T(U[X],W[X])==null){return null;}}return W;};var L=function(W,X){var V=X,T=O;for(var U in W){if(!W.hasOwnProperty(U)){continue;}if(T(W[U],X[U])==null){return null;}}return X;};var S=function(X,Y){var W=[],T=O;for(var U=Y.length-1;U>=0;U--){if(!Y.hasOwnProperty(U)){continue;}var V=Y[U];if(T(X,V)!==null){W.push(V);}}return(W.length)?W:null;};var K=function(X,Y){var W=[],T=O;for(var U in Y){if(!Y.hasOwnProperty(U)){continue;}var V=Y[U];if(T(X,V)!==null){W.push(V);}}return(W.length)?W:null;};var M=function(U,T){var V=U.constructor;if(V===RegExp){return(U.test(T))?T:null;}else{if(V===Function&&U(T)===true){return T;}}return null;};var O=function(V,T){var W;if(typeof V==="undefined"||typeof T==="undefined"||V===null||T===null){return null;}if(V===T){return T;}var X=V.constructor,U=T.constructor;if((X===Array||X===Object)&&(U===String||U===Number)){return null;}if(X===String&&U===Object&&T[V]){D.warn("sfp");R.push(T);return T;}if(U===Array){if(X===Array){W=P(V,T);}else{W=S(V,T);}}else{if(U===Object){if(X===Object){W=L(V,T);}else{W=K(V,T);}}else{if(U===String||U===Number){W=M(V,T);}}}return W!==null?W:null;};if(typeof Q==="string"){O(Q,N);D.warn("=>",R);return R;}else{return O(Q,N);}},map:function(P,N,L){var O=[],K;if(P.constructor===Array){for(var M=0;M<P.length;M++){K=N.apply(this,[P[M],M]);if(K===false||typeof K==="undefined"){continue;}if(K.constructor===Array){O=O.concat(K);}else{O.push(K);}}}else{if(P.constructor===Object){for(var M in P){K=N.apply(this,[P[M],M]);if(K===false||typeof K==="undefined"){continue;}if(K.constructor===Array){O=O.concat(K);}else{O.push(K);}}}else{throw"Store.map: First argument must be Array or Object.";}}if(L){return L.apply(this,[O]);}return O;},each:function(P,N,L){var O=[],K;if(P&&P.constructor===Array){for(var M=0;M<P.length;M++){K=N.apply(this,[P[M],M]);if(K===false){break;}O.push(K);}}else{for(var M in P){K=N.apply(this,[P[M],M]);if(K===false){break;}O.push(K);}}if(L){return L.apply(this,[O]);}return O;},extend:function(){var Q=arguments[0]||{},P=1,O=arguments.length,R=false,S;var N=this.extend;if(typeof Q==="boolean"){R=Q;Q=arguments[1]||{};P=2;}if(typeof Q!=="object"&&typeof Q!=="function"){Q={};}if(O==P){Q=this;--P;}for(;P<O;P++){if((S=arguments[P])!=null){for(var M in S){var K=Q[M],L=S[M];if(Q===L){continue;}if(R&&L&&typeof L==="object"){Q[M]=N(R,K||(L.length!=null?[]:{}),L);}else{if(L!==undefined){Q[M]=L;}}}}}return Q;},unique:function(P,K,L){var O=(typeof L==="string")?Array.prototype.slice.apply(arguments,[2]):null,M=[].concat([].concat(P).concat(K)),N=[];L=(typeof L=="function")?L:(O)?function(T,S){for(var R in T){if(O.indexOf(R)==-1||!T.hasOwnProperty(R)){continue;}if(T[R]!==S[R]){return null;}}return true;}:function(){};D.warn(P,K,L);return Q(M);function Q(X){var T=[],U=[];o:for(var S=0,W=X.length;S<W;S++){for(var R=0,V=T.length;R<V;R++){if(L(T[R],X[S])){D.warn("exists",X[S]);continue o;}else{D.warn("new",X[S]);U.push(X[S]);}}T[T.length]=X[S];}return[T,U];}}};E.utils.filter.helpers={not:function(K){return function(L){if(K.constructor!==RegExp){K=K.toString();K=new RegExp("^"+J.regexp.escape(K)+"$");}return(K.test(L))?false:true;};},iexact:function(K){return function(M){K=J.regexp.escape(K);var L=M.toString().match(new RegExp("^"+K+"$","gmi"));return L?true:false;};},icontains:function(K){return function(M){K=J.regexp.escape(K);var L=M.toString().match(new RegExp(K,"gmi"));return L?true:false;};},contains:function(K){return function(M){K=J.regexp.escape(K);var L=M.toString().match(new RegExp(K,"gm"));return L?true:false;};},isnull:function(K){return function(L){};},gt:function(K){return function(L){return L>K;};},gte:function(K){return function(L){return L>=K;};},lt:function(K){return function(L){return L<K;};},lte:function(K){return function(L){return L<=K;};},range:function(L){var M=L[0],K=L[1];return function(N){return(N>=M&&N<=K);};}};})();meelo.Store.item.last=function(A){A=parseInt(A,10)||1;var B=(A>this.data.items.length)?0:A;return Store(Array.prototype.slice.apply(this.data.items,[(B-A)]));};meelo.Store.item.sort=function(A){var C=this.items(),B=typeof A==="function",D=(!B&&A.match(/^\-/))?true:false;A=D?A.replace(/^\-/,""):A;!B?C.sort(function(F,E){return E[A]-F[A];}):C.sort(B);D&&C.reverse();return this;};meelo.Store.item.keys=function(){var A=[];this.each(function(D,B){for(var C in D){if(!A.join("\n").match(new RegExp("^"+Store.utils.regexp.escape(C)+"$","m"))){A.push(C);}}});return A;};meelo.Store.item.values=function(A){var B=[];return Store.utils.map(this.data.items,function(D,C){var E=D[A];if(!B.join("\n").match(new RegExp("^"+Store.utils.regexp.escape(E)+"$","m"))){B.push(E);return E;}},function(C){return C.reverse();});};meelo.Store.item.valuesObj=function(A){var B=[];return Store.utils.map(this.data.items,function(D,C){var E=D[A];E=(E&&E.name)?E.name:E;if(!B.join("\n").match(new RegExp("^"+Store.utils.regexp.escape(E)+"$","m"))){B.push(E);return D[A];}},function(C){return C.reverse();});};meelo.Store.item.duplicates=function(B){var A={},C=[];this.each(function(F){var E=F[B];if(typeof E==="undefined"||(typeof E!="string"&&typeof E!="number")){return ;}A[E]=A[E]||0;A[E]++;});for(var D in A){if(A[D]>1){C.push(D);}}return C;};