(function(){var a=false,f=this,d=(function(){var k=["log","error","info","warn","time","timeEnd","dir"];if(typeof f.console==="undefined"){var n={};for(var l=0;l<k.length;l++){n[k[l]]=function(){};}return n;}return f.console;})(),h=function(){return parseInt((new Date().valueOf()+Math.floor(Math.random()*new Date().valueOf()))/(Math.floor(Math.random()*9)+1),10);},c=function(){a&&d.log(Array.prototype.slice.apply(arguments,[0]));},b=function(m,l){if(!a){return;}var k=b;k.timers=k.timers||{};k.timers[m]={time:new Date().valueOf(),args:l};},i=function(n,m){if(!a){return;}var l=b;l.timers=l.timers||{};m=(m)?" ("+m+")":"";var p=(l.timers[n].args)?": "+l.timers[n].args:"",k=n+p+"\n\t"+(new Date().valueOf()-l.timers[n].time)/1000;d.log(k+m);l.timers[n]={};};var g=f.meelo=f.meelo||{};var e=f.meelo.Store=function(m,l,k){return new e.item.__init__(m,l,k);};e.item={__init__:function(m,l){var k=this;m=m||[];this.__id__=h();this.data={items:[]};this.url=null;this.__initialised__=false;this.__ready__=false;this.__loaded__=false;this.prevObj=l&&l.store?l:m&&m.__store__?m.__store__:null;this.store=true;this.selector=null;this.properties={callbacks:{init:[],update:[],ready:[]},instance_callbacks:{init:[],update:[],ready:[]},callback_queue:{}};if(this.prevObj){j.extend(this.properties,this.prevObj.properties);}else{if(l&&l.constructor===Object){j.extend(this.properties,l);}else{if(l){c("Invalid: Second argument must be an object with options");}}}this.items=function(){return this.data.items;};this.length=function(){return this.data.items.length;};if(typeof m==="string"){this.url=m;}else{this.push(m,Boolean(this.prevObj));}return this;},__load__:function(m){if(!this.url&&!m){return this;}var l=this,k=function(p,n){var q=Array.prototype.slice.apply(arguments);l.__dispatch__("callbacks","load",q);};this.url=m||this.url;this.__xhr__&&this.__xhr__.abort();this.__xhr__=jQuery.ajax({url:this.url,type:"get",dataType:"json",success:function(p,n){k.apply(this,Array.prototype.slice.apply(arguments));},error:function(p,n){k.apply(this,Array.prototype.slice.apply(arguments));}});return this;},__ready__:function(l,k){var m=[l,k];this.publish("ready",m);return this;},reload:function(k){this.data={};return this.load((k||this.url));},end:function(){return this.prevObj||e([]);},root:function(){var k=this;do{k=k.end();}while(k.end().length());return k;},__attach__:function(p,m,s){var l=this,q=this.properties[p]=this.properties[p]||{},r=this.__initialised__,k=this.properties.callback_queue[p+":"+m];q[m]=q[m]||[];c("attach",p,m);typeof s=="function"?q[m].push(s):c("Error","Second parameter must be a function");if(p=="callbacks"&&m=="init"){s.apply(l);}else{if(k&&k.length){for(var n=0;n<k.length;n++){l.__dispatch__(p,m,k[n]);}delete this.properties.callback_queue[p+":"+m];}else{this.length()&&m=="ready"&&((this.url&&this.__loaded__)||!this.url)&&l.__dispatch__(p,m);m=="load"&&!this.__xhr__&&this.__load__();}}return this;},__dispatch__:function(t,l,q){var u=this,p=this.properties[t]||{},n=p[l]||[],k,s;if(q&&q.constructor!==Array){q=[q];}c("dispatch",t,l,q,n.length);if(!n.length&&!(t=="callbacks"&&(l=="init"||l=="ready"))){this.properties.callback_queue[t+":"+l]=this.properties.callback_queue[t+":"+l]||[];this.properties.callback_queue[t+":"+l].push(q||[]);return this;}if(t=="instance_callbacks"){if((l==="init"||l=="update")&&q&&q.length>=1){j.each(q[0],function(r){m(r,q.slice(1));});}else{this.each(function(v,r){m(v);});}}else{if(l=="init"){this.__initialised__=true;}else{if(l==="ready"){this.__ready__=true;}}m(this);}return this;function m(x,v){var y;v=v||q;for(var w=0;w<n.length;w++){y=n[w].apply(x,v);if(y&&l==="load"){this.__loaded__=true;u.push(y);}if(y===false){break;}}}},init:function(k){k?this.__attach__("callbacks","init",k):this.__dispatch__("callbacks","init");return this;},ready:function(k){k?this.__attach__("callbacks","ready",k):this.__dispatch__("callbacks","ready");return this;},load:function(k){k?this.__attach__("callbacks","load",k):this.__dispatch__("callbacks","load");return this;},listen:function(k,l){return this.__attach__("callbacks",k,l);},publish:function(l,k){return this.__dispatch__("callbacks",l,k);},bind:function(k,l){return this.__attach__("instance_callbacks",k,l);},trigger:function(l,k){return this.__dispatch__("instance_callbacks",l,k);},eq:function(k){var l=this.data.items[(k||0)]||{};return e([l],this);},get:function(l){var k=this.filter.apply(this,Array.prototype.slice.apply(arguments,[0]));return k.length()?k.items()[0]:null;},slice:function(m,k){var l=this.items();return e(Array.prototype.slice.apply(l,arguments),this);},filter:function(){var w=this,q,l=Array.prototype.slice.apply(arguments),s=w.data.items,t=j,m=t.filter.helpers,n=(function(){var v=[];for(var k in m){v.push(k);}return v;})();if(l.length==2&&typeof l[0]==="string"&&typeof l[1]!=="undefined"){var p=l[0],u=l[1];l={};l[p]=u;l=[l];}b("FIND");(function r(v){var k=[];t.each(v,function(B,y){if(typeof y==="string"){var A,z=new RegExp("__("+n.join("|")+")$"),x=y.replace(z,""),C=y.match(z);if(C){C=C[1];A=m[C];v[x]=A(B);delete v[y];}}if(typeof B==="object"){r(B);}k.push(B);});return k;})(l);c("Filter:",l);q=t.map(l,function(k){return j.filter(k,s)||[];});i("FIND",q.length+" items, incl. duplicates");q=e(q,this);q.selector=l;return q;},push:function(p,l){var k=this,m,n=this.data.items=this.data.items||[];if(p.constructor==Array&&p.length){m=p;}else{if(p.constructor==Object&&p.store&&p.data.items){m=p.data.items;}else{if(p.constructor==Object){m=[p];}else{return this;}}}!l&&this.trigger("init",[m]);if(m){!l&&this.publish("beforeChange",["push",m]);this.data.items=n.concat(m);!l&&this.publish("change",["push",m]);}m&&!l&&!this.__ready__&&this.publish("ready",[m]);return this;},insert:function(k){return this.push(k);},update:function(t){if(!this.length()){return this;}var n=this,s,p=Array.prototype.slice.apply(arguments);if(p.length==2&&typeof p[0]=="string"&&typeof p[1]!=="undefined"&&j.filter(p[1].constructor,[String,Number,RegExp])){var m=p[0],l=p[1];t={};t[m]=l;}var r=0;this.publish("beforeChange",["update",this.items()]);b("Update");var q=[];this.each(function(w,u){var z={},k;for(var v in t){if(w[v]===t[v]){continue;}var y=w[v],x=t[v];k=true;r++;x=(x.constructor===Function)?x(y):(x.constructor===RegExp&&y.constructor===String)?y.match(x):x;w[v]=x;z[v]={from:y||"none",to:x};q.push(w);}k&&n.trigger("update",[[w],z]);});i("Update",this.length()+" record(s), "+r+" attribute(s)");this.publish("change",["update",q]);return this;},remove:function(){this.publish("beforeChange",["remove",k]);b("Remove");var l=this,m=this.end(),k=this.items();this.each(function(p,n){p.__delete__=true;});while(m&&m.length()){m.each(function(p,n){if(p.__delete__){this.data.items.splice(n,1);e(p).trigger("delete",[[p]]);}});m=m.end();}i("Remove");this.publish("change",["remove",k]);this.data.items=[];return this;},merge:function(n,k){d.time("Merge");var l=(typeof k==="string")?Array.prototype.slice.apply(arguments,[1]):null,m=this.items();n=(n&&n.store)?n.items():n;k=(typeof k=="function")?k:function(r,q){for(var p in r){if((l&&l.indexOf(p)===-1)||!r.hasOwnProperty(p)){continue;}if(r[p]!==q[p]){return null;}}return true;};this.length()&&this.each(function(q){for(var p=n.length-1;p>=0;p--){var s=n[p],r=k(q,s);if(r){n.splice(p,1);}}});this.push(n);d.timeEnd("Merge");return this;},print:function(k,l){k=k||this.keys();var m;if(k.constructor===String||k.constructor===Array){k=(k.constructor===Array)?k:[k];l=l||(function(){return j.map(k,function(p,n){return"$"+(n+1);},function(n){return n.reverse().join(", ");});})();this.each(function(s,n){var q=l;for(var p=k.length-1;p>=0;p--){q=q.replace(new RegExp("\\$"+(p+1),"g"),s[k[p]]||"");}return q.replace(/\$0/g,n+1);},function(n){m=n.reverse();});}return m;},each:function(l,k){l=(typeof l=="function")?l:false;if(!l||!this.data.items){return this;}return j.each.apply(this,[this.data.items,l,k]);},map:function(l,k){l=(typeof l=="function")?l:false;if(!l||!this.data.items){return this;}return j.map.apply(this,[this.data.items,l,k]);}};e.item.__init__.prototype=e.item;var j=e.utils={regexp:{escape:function(k){k=k||"";return k.toString().replace(/([.*+?^${}()|[\]\/\\])/g,"\\$1");}},filter:function(r,n){var s=[];var q=function(v,x){var z=v.length,A=x.length,w=null,u=p;if(z!==A||z===0||A===0){return null;}for(var y=z-1;y>=0;y--){if(!v.hasOwnProperty(y)||!x.hasOwnProperty(y)){continue;}if(u(v[y],x[y])==null){return null;}}return x;};var l=function(x,y){var w=y,u=p;for(var v in x){if(!x.hasOwnProperty(v)){continue;}if(u(x[v],y[v])==null){return null;}}return y;};var t=function(y,z){var x=[],u=p;for(var v=z.length-1;v>=0;v--){if(!z.hasOwnProperty(v)){continue;}var w=z[v];if(u(y,w)!==null){x.push(w);}}return(x.length)?x:null;};var k=function(y,z){var x=[],u=p;for(var v in z){if(!z.hasOwnProperty(v)){continue;}var w=z[v];if(u(y,w)!==null){x.push(w);}}return(x.length)?x:null;};var m=function(v,u){var w=v.constructor;if(w===RegExp){return(v.test(u))?u:null;}else{if(w===Function&&v(u)===true){return u;}}return null;};var p=function(w,u){var x;if(typeof w==="undefined"||typeof u==="undefined"||w===null||u===null){return null;}if(w===u){return u;}var y=w.constructor,v=u.constructor;if((y===Array||y===Object)&&(v===String||v===Number)){return null;}if(y===String&&v===Object&&u[w]){d.warn("sfp");s.push(u);return u;}if(v===Array){if(y===Array){x=q(w,u);}else{x=t(w,u);}}else{if(v===Object){if(y===Object){x=l(w,u);}else{x=k(w,u);}}else{if(v===String||v===Number){x=m(w,u);}}}return x!==null?x:null;};if(typeof r==="string"){p(r,n);d.warn("=>",s);return s;}else{return p(r,n);}},map:function(q,n,l){var p=[],k;if(q.constructor===Array){for(var m=0;m<q.length;m++){k=n.apply(this,[q[m],m]);if(k===false||typeof k==="undefined"){continue;}if(k.constructor===Array){p=p.concat(k);}else{p.push(k);}}}else{if(q.constructor===Object){for(var m in q){k=n.apply(this,[q[m],m]);if(k===false||typeof k==="undefined"){continue;}if(k.constructor===Array){p=p.concat(k);}else{p.push(k);}}}else{throw"Store.map: First argument must be Array or Object.";}}if(l){return l.apply(this,[p]);}return p;},each:function(q,n,l){var p=[],k;if(q&&q.constructor===Array){for(var m=0;m<q.length;m++){k=n.apply(this,[q[m],m]);if(k===false){break;}p.push(k);}}else{for(var m in q){k=n.apply(this,[q[m],m]);if(k===false){break;}p.push(k);}}if(l){return l.apply(this,[p]);}return p;},extend:function(){var r=arguments[0]||{},q=1,p=arguments.length,s=false,t;var n=this.extend;if(typeof r==="boolean"){s=r;r=arguments[1]||{};q=2;}if(typeof r!=="object"&&typeof r!=="function"){r={};}if(p==q){r=this;--q;}for(;q<p;q++){if((t=arguments[q])!=null){for(var m in t){var k=r[m],l=t[m];if(r===l){continue;}if(s&&l&&typeof l==="object"){r[m]=n(s,k||(l.length!=null?[]:{}),l);}else{if(l!==undefined){r[m]=l;}}}}}return r;},unique:function(q,k,l){var p=(typeof l==="string")?Array.prototype.slice.apply(arguments,[2]):null,m=[].concat([].concat(q).concat(k)),n=[];l=(typeof l=="function")?l:(p)?function(u,t){for(var s in u){if(p.indexOf(s)==-1||!u.hasOwnProperty(s)){continue;}if(u[s]!==t[s]){return null;}}return true;}:function(){};d.warn(q,k,l);return r(m);function r(A){var u=[],v=[];o:for(var t=0,z=A.length;t<z;t++){for(var s=0,w=u.length;s<w;s++){if(l(u[s],A[t])){d.warn("exists",A[t]);continue o;}else{d.warn("new",A[t]);v.push(A[t]);}}u[u.length]=A[t];}return[u,v];}}};e.utils.filter.helpers={not:function(k){return function(l){if(k.constructor!==RegExp){k=k.toString();k=new RegExp("^"+j.regexp.escape(k)+"$");}return(k.test(l))?false:true;};},iexact:function(k){return function(m){k=j.regexp.escape(k);var l=m.toString().match(new RegExp("^"+k+"$","gmi"));return l?true:false;};},icontains:function(k){return function(m){k=j.regexp.escape(k);var l=m.toString().match(new RegExp(k,"gmi"));return l?true:false;};},contains:function(k){return function(m){k=j.regexp.escape(k);var l=m.toString().match(new RegExp(k,"gm"));return l?true:false;};},isnull:function(k){return function(l){};},gt:function(k){return function(l){return l>k;};},gte:function(k){return function(l){return l>=k;};},lt:function(k){return function(l){return l<k;};},lte:function(k){return function(l){return l<=k;};},range:function(l){var m=l[0],k=l[1];return function(n){return(n>=m&&n<=k);};}};})();meelo.Store.item.last=function(a){a=parseInt(a,10)||1;var b=(a>this.data.items.length)?0:a;return Store(Array.prototype.slice.apply(this.data.items,[(b-a)]));};meelo.Store.item.sort=function(a){var c=this.data.items,b=typeof a==="function",d=(!b&&a.match(/^\-/))?true:false;a=d?a.replace(/^\-/,""):a;!b?c.sort(function(f,e){return e[a]>f[a];}):c.sort(b);d&&c.reverse();return this;};meelo.Store.item.keys=function(){var a=[];this.each(function(d,b){for(var c in d){if(!a.join("\n").match(new RegExp("^"+Store.utils.regexp.escape(c)+"$","m"))){a.push(c);}}});return a;};meelo.Store.item.values=function(a){var b=[];return Store.utils.map(this.data.items,function(d,c){var e=d[a];if(!b.join("\n").match(new RegExp("^"+Store.utils.regexp.escape(e)+"$","m"))){b.push(e);return e;}},function(c){return c.reverse();});};meelo.Store.item.valuesObj=function(a){var b=[];return Store.utils.map(this.data.items,function(d,c){var e=d[a];e=(e&&e.name)?e.name:e;if(!b.join("\n").match(new RegExp("^"+Store.utils.regexp.escape(e)+"$","m"))){b.push(e);return d[a];}},function(c){return c.reverse();});};meelo.Store.item.duplicates=function(b){var a={},c=[];this.each(function(f){var e=f[b];if(typeof e==="undefined"||(typeof e!="string"&&typeof e!="number")){return;}a[e]=a[e]||0;a[e]++;});for(var d in a){if(a[d]>1){c.push(d);}}return c;};